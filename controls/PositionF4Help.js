sap.ui.define(["jquery.sap.global","sap/ui/model/Filter","sap/ui/comp/filterbar/FilterBar","sap/ui/model/FilterOperator","sap/ui/comp/valuehelpdialog/ValueHelpDialog"],function(e,t,a,o,s){"use strict";return{showValueHelpDialog:function(e,t){try{t=t===null||t===undefined?w():t;t.autoFill=!f(t.autoFill)||t.autoFill?true:false;t.control=!f(t.control)?!f(t.isFragment)?sap.ui.core.Fragment.byId(e.createId(t.fragmentName),t.idOfUIElement):e.getView().byId(t.idOfUIElement):t.control;t.title=!f(t.title)?"Position ID":t.title;t.multiSelect=f(t.multiSelect)?t.multiSelect:false;t.isFragment=t.isFragment!==""&&t.isFragment?true:false;t.getToken=t.getToken!==""&&t.getToken?true:false;if(e.vhDialog!==undefined){e.vhDialog.destroy()}e.vhDialog=n(e,t)}catch(e){M(e)}}};function n(t,a){try{if(!f(a.reqestedField)){a.reqestedField="PositionId"}var o=new sap.ui.comp.valuehelpdialog.ValueHelpDialog(t.createId("F4H"),{basicSearchText:a.inputValue,title:a.title,supportMultiselect:a.multiSelect,supportRanges:false,supportRangesOnly:false,key:"PositionId",descriptionKey:"nachn",ok:function(e){var s=o.getTable();var n=s.getSelectedIndices();var i=sap.ui.getCore().getModel().getProperty("/");i=[];for(var r=0;r<n.length;r++){i.push(s.getModel().getProperty("/"+String(n[r])))}if(!a.autoFill){try{t.onPositionHelpSelection(i,a.scenario);o.close()}catch(e){sap.m.MessageToast.show(" Implement of onPositionHelpSelection(oModel) is missing")}}else if(h(a.control)){try{if(a.getToken&&a.control.getEnableMultiLineMode()){a.control.setTokens(e.getParameter("tokens"));o.close()}else if(!a.getToken){a.control.setValue(i[0][a.reqestedField]);o.close()}}catch(e){sap.m.MessageToast.show("Token assingment failed.")}if(a.oModel!==undefined&&a.control.getModel(a.oModel)!==undefined){if(a.control.getModel(a.oModel).getData().length>0){i.forEach(function(e){a.control.getModel(a.oModel).getData().push(e)})}else{a.control.getModel(a.oModel).setData(i)}a.control.getModel(a.oModel).refresh()}else if(a.oModel!==""&&a.oModel!==undefined){var l=new sap.ui.model.json.JSONModel;l.setData(i);a.control.setModel(l,a.oModel)}}else{sap.m.MessageToast.show("Element is not available !!!")}o.close()},cancel:function(e){sap.m.MessageToast.show("Cancel pressed!");o.close()},afterClose:function(){o.destroy()}});sap.ui.getCore().setModel(P());o.getTable().setModel(y(),"columns");o.getTable().setModel(r());try{o.getTable().bindRows("/")}catch(t){e.sap.log.debug(t)}o.setRangeKeyFields([{label:"Personnel ID",key:"PositionId"},{label:"Position Name",key:"nachn"}]);try{var s=a.fragmentName!==undefined&&a.fragmentName.length>0?sap.ui.core.Fragment.byId(t.createId(a.fragmentName),a.idOfUIElement):t.getView().byId(a.idOfUIElement);if(h(a.idOfUIElement)&&s!==undefined&&a.getToken&&a.oModel.length===0){o.setTokens(s.getTokens())}}catch(e){sap.m.MessageToast.show("Token assingment failed.")}if(f(a.reqestedField)){l(t,o,a.reqestedField)}o.addStyleClass(t.theTokenInput!==undefined&&t.theTokenInput.$().closest(".sapUiSizeCompact").length>0?"sapUiSizeCompact":"sapUiSizeCozy");t._oBasicSearchField=new sap.m.SearchField({showSearchButton:true,search:function(){o.getFilterBar().search()}});o.getFilterBar().setBasicSearch(t._oBasicSearchField);o.open();o.update();return o}catch(e){M(e)}}function i(e){if(e===undefined){sap.m.MessageToast.show("View is not available !!!");return false}else{return true}}function r(){try{var e=new sap.ui.model.json.JSONModel;e.setData([]);return e}catch(e){sap.m.MessageToast.show("Error !!!")}}function l(e,t,a){try{if(a===undefined){a="PositionId"}var o;if(e.getView().getModel("suggetionModel")===undefined){o=new sap.ui.model.json.JSONModel({PArea:[],PSArea:[],EmpInfo:[]});e.getView().setModel(o,"suggetionModel")}var s=S(t);s.setModel(e.getView().getModel("suggetionModel"));t.setFilterBar(s)}catch(e){sap.m.MessageToast.show("Error !!!")}}function u(e){try{var t=e.getView().getModel("suggetionModel");if(t!==undefined){if(t.getData().PArea.length<1){m("/sap/opu/odata/sap/ZGECAGS006_SRV/PerAreaSet",e)}if(t.getData().PSArea.length<1){m("/sap/opu/odata/sap/ZGECAGS006_SRV/PerSubAreaSet",e)}if(t.getData().EmpInfo.length<1){var a=c(new Date);m("/sap/opu/odata/sap/ZGEOM_C_POSITION_VALUEHELP_CDS/ZGEOM_C_POSITION_VALUEHELP('"+a+"')/Set?$select=PositionId,PositionName,OrgId,OrgDescription&$filter=substringof('',PositionId) and substringof('',PositionName) and substringof('',OrgId) and substringof('',OrgDescription) ",e)}}}catch(e){sap.m.MessageToast.show("Error !!!")}}function d(t,a){try{a.setBusy(true);var o=c(new Date);var s="/sap/opu/odata/sap/ZGEOM_C_POSITION_VALUEHELP_CDS/";var n="ZGEOM_C_POSITION_VALUEHELP('"+o+"')/Set";var i=new sap.ui.model.odata.ODataModel(s,false);i.read(n,{filters:[t],success:e.proxy(g,a),error:e.proxy(p,a)})}catch(e){sap.m.MessageToast.show("Error !!!");this.setBusy(false)}}function g(e,t,a){try{this.getTable().getModel().oData=e.results;this.getTable().getModel().refresh();this.setBusy(false)}catch(e){sap.m.MessageToast.show("Error !!!");this.setBusy(false)}}function p(e,t,a){try{this.setBusy(false);sap.m.MessageToast.show("Error while retreaving data !!!")}catch(e){sap.m.MessageToast.show("Error !!!");this.setBusy(false)}}function c(e){var t=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyyMMdd"});return t.format(e)}function f(e){return e!==null&&e!==undefined}function h(e){return e!==null&&e!==undefined&&e!==""}function m(e,t){try{var a=new sap.ui.model.json.JSONModel;a.attachEventOnce("requestCompleted",function(e){var t=e.getParameter("url").split("/")[e.getParameter("url").split("/").length-1];if(a.getData().d!==undefined)if(t.indexOf("PerAreaSet")===0){this.getView().getModel("suggetionModel").getData().PArea=a.getData().d.results}else if(t.indexOf("PerSubAreaSet")===0){this.getView().getModel("suggetionModel").getData().PSArea=a.getData().d.results}else if(t.indexOf("ZGEOM_C_POSITION_VALUEHELP")===0){this.getView().getModel("suggetionModel").getData().EmpInfo=a.getData().d.results}this.getView().getModel("suggetionModel").refresh()},t).loadData(e)}catch(e){return[]}}function M(e){try{sap.m.MessageToast.show("Error !!!"+e.message);if(e.message.indexOf("adding element with duplicate id")!==-1){if(sap.ui.getCore().byId(e.message.split("'")[1])!==undefined){sap.ui.getCore().byId(e.message.split("'")[1]).destroy()}}}catch(e){}}function I(){var e={basicSearchText:"",title:"Position ID",multiSelect:false,maxIncludeRanges:"2",supportRanges:false,supportRangesOnly:false,key:"PositionId",descriptionKey:"nachn",stretch:sap.ui.Device.system.phone};return e}function w(){return{title:"Position ID",control:null,getToken:true,idOfUIElement:"",reqestedField:"PositionId",multiSelect:false,inputValue:"",isFragment:false,view:"",oModel:"",fragmentName:"",autoFill:true,scenario:""}}function P(){try{var e=[];var t=new sap.ui.model.json.JSONModel;t.setData(e);sap.ui.getCore().setModel(t);return t}catch(e){sap.m.MessageToast.show("Error !!!")}}function y(){try{var e=new sap.ui.model.json.JSONModel;e.setData({cols:[{label:"Position ID",template:"PositionId"},{label:"Position Name",template:"PositionName"},{label:"Organizational Unit",template:"OrgId"},{label:"Organizational Unit Name",template:"OrgDescription"}]});return e}catch(e){sap.m.MessageToast.show("Error !!!")}}function O(e,t,a,o,s,n,i,r,l){try{return new sap.ui.comp.filterbar.FilterGroupItem({groupTitle:e,groupName:t,name:a,label:o,control:new sap.m.Input(s,{placeholder:n,type:sap.m.InputType.Text,showSuggestion:true,liveChange:function(){if(this.getValue().length>0){this.bindAggregation("suggestionItems",i,new sap.ui.core.Item({key:r,text:l}))}}})})}catch(e){}}function S(e){try{var a=new sap.ui.comp.filterbar.FilterBar({advancedMode:true,filterBarExpanded:true,filterGroupItems:[O("empGrp","gn1","n1","Position ID","searchInput1","Search Position ID","/EmpInfo","{PositionId}","{PositionId}"),O("empGrp","gn1","n2","Position Name","searchInput2","Search Position Name","/EmpInfo","{PositionName}","{PositionName}"),O("empGrp","gn1","n3","Organizational Unit","searchInput3","Search Organizational Unit","/EmpInfo","{OrgId}","{OrgId}"),O("empGrp","gn1","n4","Organizational Unit Name","searchInput4","Search Organizational Unit Name","/EmpInfo","{OrgDescription}","{OrgDescription}")],search:function(a){var s=this._oBasicSearchField.getValue();var n=[];var i=[];var r=[];if(s){i.push(new t({filters:[new t({path:"PositionId",operator:o.Contains,value1:s}),new t({path:"PositionName",operator:o.Contains,value1:s}),new t({path:"OrgId",operator:o.Contains,value1:s}),new t({path:"OrgDescription",operator:o.EQ,value1:s})],and:false}))}var l=a.getParameter("selectionSet");var u=l[0].getValue();var g=l[1].getValue();var p=l[2].getValue();var c=l[3].getValue();if(u){r.push(new t({path:"PositionId",operator:o.Contains,value1:u}))}if(g){r.push(new t({path:"pernr",operator:o.Contains,value1:g}))}if(p){r.push(new t({path:"OrgId",operator:o.Contains,value1:p}))}if(c){r.push(new t({path:"OrgDescription",operator:o.Contains,value1:c}))}if(i.length>0&&r.length>0){i.push(new t(r,true));n.push(new t({filters:i,and:true}))}else if(r.length>0){n.push(new t({filters:r,and:true}))}else if(i.length>0){n.push(new t({filters:i,and:true}))}d(n,e)}});return a}catch(e){sap.m.MessageToast.show("Error in filter bar")}}},true);