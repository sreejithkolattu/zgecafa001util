sap.ui.define(["zgecafa001util/zgecafa001util/controls/FragmentUtility"],function(e){"use strict";return{ref:null,_handleNotificationPref:function(e,t,o){this.ref=e;if(!this.oEmailPopover){this.oEmailPopover=new sap.m.Popover("gPPEmailId",{title:"Notification Preference",contentWidth:"35%",contentHeight:"20%",class:"sapUiContentPadding",placement:"Bottom",initialFocus:"btnSendId",footer:[new sap.m.Toolbar],content:[],afterClose:function(e){e.getSource().close()}});this.oEmailPopover.setFooter(false);this.oEmailPopover.setModel(new sap.ui.model.json.JSONModel({Source:o}),"notiPreModel")}this.oEmailPopover.openBy(t.getSource());this.readPrefernceEmail(o)},_addContent:function(){var e=new sap.m.CheckBox({text:"Official email: {notiPreModel>/Oemail}",selected:"{notiPreModel>/Ioemail}"});var t=new sap.m.CheckBox({text:"Personal email: {notiPreModel>/Pemail}",selected:"{notiPreModel>/Ipemail}"});var o=new sap.m.Label({text:"Note: Changes will be effective from start date of next month"});var s=new sap.m.VBox;s.addItem(e);s.addItem(t);s.addItem(o);s.addStyleClass("sapUiSmallMarginBegin");o.addStyleClass("sapUiSmallMarginBegin");this.oEmailPopover.addContent(s)},_addFooter:function(){var e=this;var t=new sap.m.Button("btnSendId",{text:"SEND",press:function(t){e.sendMailPref(t.getSource().getModel("notiPreModel").getData())}});var o=new sap.m.Button("btnCancelId",{text:"CANCEL",press:function(e){e.getSource().getParent().getParent().close()}});var s=new sap.m.ToolbarSpacer;this.oEmailPopover.getFooter().addContent(s);this.oEmailPopover.getFooter().addContent(o);this.oEmailPopover.getFooter().addContent(t)},readPrefernceEmail:function(e){this.toggleBusy();var t="/sap/opu/odata/sap/ZGEPYGS008_SRV";var o=new sap.ui.model.odata.v2.ODataModel(t);var s="/NotificationPrefSet(Source='"+e+"')";o.read(s,{success:function(e){this._addContent();this._addFooter();this.oEmailPopover.setFooter(true);this.oEmailPopover.getModel("notiPreModel").setData(e);this.oEmailPopover.getModel("notiPreModel").refresh();this.toggleBusy()}.bind(this),error:function(e){this._showCustomServiceError(e);this.oEmailPopover.setFooter(false);this.toggleBusy()}.bind(this)})},sendMailPref:function(e){this.toggleBusy();var t="/sap/opu/odata/sap/ZGEPYGS008_SRV";var o=new sap.ui.model.odata.v2.ODataModel(t,{defaultUpdateMethod:"PUT"});var s=o.createKey("NotificationPrefSet",e);o.update("/"+s,e,{success:function(e){this._fnSuccessMessage();this.toggleBusy()}.bind(this),error:function(e){this._showCustomServiceError(e)}.bind(this)})},toggleBusy:function(){this.oEmailPopover.setBusy(!this.oEmailPopover.getBusy());this.oEmailPopover.setBusyIndicatorDelay(0)},_fnSuccessMessage:function(){var t=new sap.ui.model.json.JSONModel({Title:"Success",BtnNoText:"OK",BtnYesText:"OK",SubTitle:"Changes will be effective from start date of next month.",BtnOkText:"OK"});e.handleSuccessDialog(this.ref,t,"SuccessDlgId");sap.ui.core.Fragment.byId(this.ref.createId("SuccessDlgId"),"btnOk").attachPress(function(){if(this.oEmailPopover){this.oEmailPopover.close()}}.bind(this))},_fnErrorMessage:function(){var t=new sap.ui.model.json.JSONModel({Title:"Error",BtnNoText:"OK",BtnYesText:"OK",SubTitle:"No notification preference found",BtnOkText:"OK"});e.handleErrorDialog(this.ref,t,"ErrorDlgId");sap.ui.core.Fragment.byId(this.ref.createId("ErrorDlgId"),"btnOk").attachPress(function(){if(this.oEmailPopover){this.oEmailPopover.close()}}.bind(this))},_showCustomServiceError:function(t){var o=t.headers["Content-Type"];var s=t.response;if(t.statusCode===504){t.message="Error";s="Socket connection timed out for host"}else{if(!o||t.headers["Content-Type"].indexOf("json")<=0){if(t.responseText){s=jQuery.parseXML(t.responseText).querySelector("message").textContent}else{s=jQuery.parseXML(t.body).querySelector("message").textContent}}else{if(t.responseText){s=JSON.parse(t.responseText).error.message.value}}}var i=new sap.ui.model.json.JSONModel({Title:t.message,SubTitle:s,BtnOkText:"OK"});e.handleODataErrorDialog(null,i,"fgCustomServerErrorId",function(){if(this.oEmailPopover){this.oEmailPopover.close()}}.bind(this))}}});