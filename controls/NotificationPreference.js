sap.ui.define(["zgecafa001util/zgecafa001util/controls/FragmentUtility"],function(e){"use strict";return{ref:null,_handleNotificationPref:function(e,t,o){this.ref=e;if(!this.oEmailPopover){this.oEmailPopover=new sap.m.Popover("gPPEmailId",{title:"Notification Preference",contentWidth:"35%",contentHeight:"20%",class:"sapUiContentPadding",placement:"Bottom",initialFocus:"btnSendId",footer:[new sap.m.Toolbar],content:[],afterClose:function(e){e.getSource().close()}});this.oEmailPopover.setFooter(false);this.oEmailPopover.setModel(new sap.ui.model.json.JSONModel({Source:o}),"notiPreModel")}this.oEmailPopover.openBy(t.getSource());this.readPrefernceEmail(o)},_addContent:function(){var e=new sap.m.CheckBox({text:"Official email: {notiPreModel>/Oemail}",selected:"{notiPreModel>/Ioemail}"});var t=new sap.m.CheckBox({text:"Personal email: {notiPreModel>/Pemail}",selected:"{notiPreModel>/Ipemail}"});var o=new sap.m.Label({text:"Note: Changes will be effective from start date of next month"});var a=new sap.m.VBox;a.addItem(e);a.addItem(t);a.addItem(o);a.addStyleClass("sapUiSmallMarginBegin");o.addStyleClass("sapUiSmallMarginBegin");this.oEmailPopover.addContent(a)},_addFooter:function(){var e=this;var t=new sap.m.Button("btnSendId",{text:"SEND",press:function(t){e.sendMailPref(t.getSource().getModel("notiPreModel").getData())}});var o=new sap.m.Button("btnCancelId",{text:"CANCEL",press:function(e){e.getSource().getParent().getParent().close()}});var a=new sap.m.ToolbarSpacer;this.oEmailPopover.getFooter().addContent(a);this.oEmailPopover.getFooter().addContent(o);this.oEmailPopover.getFooter().addContent(t)},readPrefernceEmail:function(e){this.toggleBusy();var t="/sap/opu/odata/sap/ZGEPYGS008_SRV";var o=new sap.ui.model.odata.v2.ODataModel(t);var a="/NotificationPrefSet(Source='"+e+"1')";o.read(a,{success:function(e){this._addContent();this._addFooter();this.oEmailPopover.setFooter(true);this.oEmailPopover.getModel("notiPreModel").setData(e);this.oEmailPopover.getModel("notiPreModel").refresh();this.toggleBusy()}.bind(this),error:function(e){this._fnErrorMessage();this.oEmailPopover.setFooter(false);this.toggleBusy()}.bind(this)})},sendMailPref:function(e){this.toggleBusy();var t="/sap/opu/odata/sap/ZGEPYGS008_SRV";var o=new sap.ui.model.odata.v2.ODataModel(t,{defaultUpdateMethod:"PUT"});var a=o.createKey("NotificationPrefSet",e);o.update("/"+a,e,{success:function(e){this._fnSuccessMessage();this.toggleBusy()}.bind(this),error:function(e){}.bind(this)})},toggleBusy:function(){this.oEmailPopover.setBusy(!this.oEmailPopover.getBusy());this.oEmailPopover.setBusyIndicatorDelay(0)},_fnSuccessMessage:function(){var t=new sap.ui.model.json.JSONModel({Title:"Success",BtnNoText:"OK",BtnYesText:"OK",SubTitle:"Changes will be effective from start date of next month.",BtnOkText:"OK"});e.handleSuccessDialog(this.ref,t,"SuccessDlgId");sap.ui.core.Fragment.byId(this.ref.createId("SuccessDlgId"),"btnOk").attachPress(function(){if(this.oEmailPopover){this.oEmailPopover.close()}}.bind(this))},_fnErrorMessage:function(){var t=new sap.ui.model.json.JSONModel({Title:"Error",BtnNoText:"OK",BtnYesText:"OK",SubTitle:"No notification preference found",BtnOkText:"OK"});e.handleErrorDialog(this.ref,t,"ErrorDlgId");sap.ui.core.Fragment.byId(this.ref.createId("ErrorDlgId"),"btnOk").attachPress(function(){if(this.oEmailPopover){this.oEmailPopover.close()}}.bind(this))}}});